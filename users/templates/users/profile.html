{% extends 'base.html' %}
{% block content %}

<h1 class="h4">profile: <span id="profile-username">{{ username }}</span></h1>

<div id="profile-root" data-username="{{ username }}">
  <div class="card mb-3">
    <div class="card-body d-flex align-items-start">
      <div class="me-3">
        <img id="profile-avatar" src="" alt="avatar" class="rounded" style="width:72px;height:72px;object-fit:cover;" />
      </div>

      <div class="flex-grow-1">
        <div class="mb-1"><strong id="profile-name"></strong></div>
        <div class="text-muted small">joined: <span id="profile-joined"></span></div>
        <div class="text-muted small">device: <span id="profile-device"></span></div>
      </div>

      <div class="ms-auto text-end" id="profile-controls">
        <div class="btn-group btn-group-sm mb-1" role="group" aria-label="profile-controls">
          {% if request.user.is_authenticated and request.user.username == username %}
          <a class="btn btn-sm btn-outline-secondary" title="edit" href="/u/{{ username }}/edit/"><i class="bi bi-pencil"></i></a>
          {% endif %}
          {% if request.user.is_staff %}
          <button class="btn btn-outline-secondary" id="btn-unsilence" title="unsilence" style="display:none;"><i class="bi bi-bell"></i></button>
          <button class="btn btn-outline-secondary" id="btn-unban" title="unban" style="display:none;"><i class="bi bi-unlock"></i></button>
          <button class="btn btn-outline-dark" id="btn-mod-open" title="ban options"><i class="bi bi-lightning-charge"></i></button>
          {% endif %}
        </div>
        {% if request.user.is_staff %}
        <div class="small text-muted" id="mod-state"></div>
        {% endif %}
      </div>
      </div>

    </div>
  </div>

  <!-- ADMIN MODERATION MODAL (NO ANIMATION) -->
  <div id="mod-modal" class="position-fixed top-0 start-0 w-100 h-100"
    style="display:none;background:rgba(0,0,0,.35);z-index:1070;">
    <div class="container h-100 d-flex align-items-start justify-content-center" style="padding-top:10vh;">
      <div class="card" style="max-width:600px;width:100%;">
        <div class="card-header d-flex justify-content-between align-items-center">
          <strong>moderation</strong>
          <div>
            <a href="#" id="mod-close" class="btn btn-sm btn-secondary">close</a>
          </div>
        </div>
        <div class="card-body">
          <div class="mb-2"><span class="text-muted small">silence (severity 1)</span></div>
          <div class="btn-group btn-group-sm mb-3" role="group">
            <button class="btn btn-outline-warning" data-mod-action="silence" data-secs="86400" title="silence 24h"><i
                class="bi bi-volume-mute"></i> 24h</button>
            <button class="btn btn-outline-warning" data-mod-action="silence" data-secs="604800" title="silence 7d"><i
                class="bi bi-volume-mute"></i> 7d</button>
          </div>
          <div class="mb-2"><span class="text-muted small">ban (severity 2)</span></div>
          <div class="btn-group btn-group-sm" role="group">
            <button class="btn btn-outline-danger" data-mod-action="ban" data-secs="86400" title="ban 24h"><i
                class="bi bi-slash-circle"></i> 24h</button>
            <button class="btn btn-outline-danger" data-mod-action="ban" data-secs="604800" title="ban 7d"><i
                class="bi bi-slash-circle"></i> 7d</button>
            <button class="btn btn-outline-danger" data-mod-action="ban" data-secs="2592000" title="ban 30d"><i
                class="bi bi-slash-circle"></i> 30d</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span>comments</span>

      {% if request.user.is_authenticated and request.user.username != username %}

      <form id="form-profile-comment" class="d-flex" data-endpoint="/api/users/{{ username }}/comments/">
        <input class="form-control form-control-sm me-2" name="body" placeholder="leave a comment" required />
        <button class="btn btn-sm btn-primary" type="submit">send</button>
      </form>

      {% endif %}

    </div>

    <ul class="list-group list-group-flush" id="profile-comments" data-endpoint="/api/users/{{ username }}/comments/">
    </ul>
  </div>
</div>

{% endblock %}
